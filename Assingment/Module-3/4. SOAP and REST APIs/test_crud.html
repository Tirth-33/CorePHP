<!DOCTYPE html>
<html>
<head>
    <title>Product CRUD API Test</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 20px auto; padding: 20px; }
        .section { background: #f8f9fa; padding: 20px; margin: 20px 0; border-radius: 8px; }
        .form-group { margin-bottom: 15px; }
        input, select, textarea { padding: 8px; width: 200px; margin-right: 10px; }
        button { background: #007bff; color: white; border: none; padding: 10px 15px; border-radius: 4px; cursor: pointer; margin-right: 10px; }
        .delete { background: #dc3545; }
        .update { background: #28a745; }
        .result { background: white; padding: 15px; border-radius: 5px; margin-top: 15px; border-left: 4px solid #007bff; }
        .products { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; }
        .product { background: white; padding: 15px; border-radius: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>Product CRUD API Test</h1>

    <!-- CREATE -->
    <div class="section">
        <h3>Create Product</h3>
        <div class="form-group">
            <input type="text" id="createName" placeholder="Product Name">
            <input type="number" id="createPrice" placeholder="Price">
        </div>
        <div class="form-group">
            <input type="text" id="createCategory" placeholder="Category">
            <textarea id="createDesc" placeholder="Description"></textarea>
        </div>
        <button onclick="createProduct()">Create Product</button>
        <div id="createResult" class="result" style="display:none;"></div>
    </div>

    <!-- READ -->
    <div class="section">
        <h3>All Products</h3>
        <button onclick="loadProducts()">Load Products</button>
        <div id="productsList" class="products"></div>
    </div>

    <!-- UPDATE -->
    <div class="section">
        <h3>Update Product</h3>
        <div class="form-group">
            <input type="number" id="updateId" placeholder="Product ID">
            <input type="text" id="updateName" placeholder="New Name">
            <input type="number" id="updatePrice" placeholder="New Price">
        </div>
        <button onclick="updateProduct()" class="update">Update Product</button>
        <div id="updateResult" class="result" style="display:none;"></div>
    </div>

    <!-- DELETE -->
    <div class="section">
        <h3>Delete Product</h3>
        <input type="number" id="deleteId" placeholder="Product ID">
        <button onclick="deleteProduct()" class="delete">Delete Product</button>
        <div id="deleteResult" class="result" style="display:none;"></div>
    </div>

    <script>
        const API_URL = './products_api.php';

        async function apiCall(method, data = null) {
            const options = {
                method: method,
                headers: {'Content-Type': 'application/json'}
            };
            if (data) options.body = JSON.stringify(data);
            
            const response = await fetch(API_URL, options);
            return await response.json();
        }

        async function createProduct() {
            const data = {
                name: document.getElementById('createName').value,
                price: parseFloat(document.getElementById('createPrice').value),
                category: document.getElementById('createCategory').value,
                description: document.getElementById('createDesc').value
            };
            
            const result = await apiCall('POST', data);
            document.getElementById('createResult').style.display = 'block';
            document.getElementById('createResult').innerHTML = JSON.stringify(result, null, 2);
            
            if (result.success) {
                document.getElementById('createName').value = '';
                document.getElementById('createPrice').value = '';
                document.getElementById('createCategory').value = '';
                document.getElementById('createDesc').value = '';
                loadProducts();
            }
        }

        async function loadProducts() {
            const products = await apiCall('GET');
            const container = document.getElementById('productsList');
            
            if (Array.isArray(products) && products.length > 0) {
                container.innerHTML = products.map(p => `
                    <div class="product">
                        <h4>${p.name}</h4>
                        <p><strong>ID:</strong> ${p.id}</p>
                        <p><strong>Price:</strong> &#8377;${p.price}</p>
                        <p><strong>Category:</strong> ${p.category}</p>
                        <p><strong>Description:</strong> ${p.description}</p>
                    </div>
                `).join('');
            } else {
                container.innerHTML = '<p>No products found</p>';
            }
        }

        async function updateProduct() {
            const data = {
                id: parseInt(document.getElementById('updateId').value),
                name: document.getElementById('updateName').value,
                price: parseFloat(document.getElementById('updatePrice').value)
            };
            
            const result = await apiCall('PUT', data);
            document.getElementById('updateResult').style.display = 'block';
            document.getElementById('updateResult').innerHTML = JSON.stringify(result, null, 2);
            
            if (result.success) {
                loadProducts();
            }
        }

        async function deleteProduct() {
            const data = {
                id: parseInt(document.getElementById('deleteId').value)
            };
            
            const result = await apiCall('DELETE', data);
            document.getElementById('deleteResult').style.display = 'block';
            document.getElementById('deleteResult').innerHTML = JSON.stringify(result, null, 2);
            
            if (result.success) {
                loadProducts();
            }
        }

        // Load products on page load
        loadProducts();
    </script>
</body>
</html>